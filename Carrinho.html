<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NuVy - Carrinho</title>
  <link rel="stylesheet" href="css/geral.css">
  <style>
    /* Header com nuvenzinha arredondada */
    .pill{
      background: black;
      padding: 8px 18px;
      border-radius: 28px;
      font-weight: 800;
      color: white;
      text-decoration: none;
      letter-spacing: 0.6px;
    }

    main{
      flex: 1;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 36px;
    }
    
    .frame{    
      width: 1100px;
      background: linear-gradient(to left, rgb(64, 131, 255), rgb(0, 63, 134));
      border-radius: 12px;
      padding: 26px 36px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.3);
      position: relative;
    }

    .title{
      font-size: 56px;
      text-align: center;
      font-weight: 800;
      color: rgba(255,255,255,0.95);
      text-shadow: 0 4px 18px rgba(0,0,0,0.5);
    }

    .cart-list{
      margin-top: 20px;
    }

    .item{
      display: flex;
      align-items: center;
      gap: 18px;
      padding: 18px;
      border-radius: 18px;
      background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(0,0,0,0.18));
      border: 2px solid rgba(255,255,255,0.06);
      margin-bottom: 14px;
      position: relative;
    }

    .thumb{
      width: 88px;
      height: 88px;
      border-radius: 12px;
      overflow: hidden;
      flex-shrink: 0;
      border: 6px solid rgba(255,255,255,0.04)
    }

    .thumb img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .meta{
      flex: 1;
    }

    .meta h3{
      margin: 0;
      font-size: 18px;
    }

    .meta p{
      margin: 6px 0;
      color: var(--muted);
      font-size: 14px;
    }

    .meta .price-badge{
      display: inline-block;
      background:rgba(255,255,255,0.06);
      padding: 8px 12px;
      border-radius: 18px;
      font-weight: 700;
    }
    
    .right{
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }

    .qtd{
      background: rgba(224, 18, 18, 0.03);
      padding: 6px 12px;
      border-radius: 10px;
    }

    .actions{
      display: flex;
      gap: 8px;
    }

    .btn{
      background: linear-gradient(#0f676d,#0b4046);
      border-radius: 20px;
      padding: 8px 12px;
      color: #e9f9fa;
      border: 0;
      cursor: pointer;
      font-weight: 700;
    }

    .del{
      background: linear-gradient(rgb(202, 0, 0), darkred);
      color: white;
      padding: 6px 10px;
    }

    .frete{
      color: lime;
      font-weight: 800;
    }

    .total-bar{
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 18px;
      border-radius: 10px;
      margin-top: 18px;
      background: rgba(0,0,0,0.22);
    }

    .total-bar .cart-icon{
      font-size: 22px;
      margin-right: 8px;
    }

    .controls{
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .form-inline{
      display: flex;
      gap: 8px;
      align-items: center;
    }

    input[type="text"], input[type="number"]{
      padding: 10px;
      border-radius: 10px;
      border: 0;
      background: white;
      color: white;
    }

    /* painel pedag√≥gico */
    .pedagogic{
      margin-top: 18px;
      background: rgba(255,255,255,0.02);
      padding: 14px;
      border-radius: 10px;
      color: #e6f7f8;
    }

    pre{
      white-space: pre-wrap;
      margin: 0;
      font-size: 13px;
      color: #f3fbff;
    }

  </style>
  <script src="js/loginChecker.js"></script>
</head>
<body>
  <header>
    <div class="logo">
      <h1>NuVy</h1>
      <div class="nuvem"></div>
    </div>
    <nav>
      <a href="index.html" class="btnNav" id="produtosBtn">PRODUTOS</a>
      <a href="Cadastro.html" class="btnNav" id="cadastrarBtn" hidden="true">CADASTRAR</a>
      <a href="entrar.html" class="btnNav" id="entrarBtn" hidden="true">ENTRAR</a>
      <a href="Carrinho.html" class="btnNav" id="carrinhoBtn">CARRINHO</a>
      <a href="sair.html" class="btnNav" id="logoutBtn" hidden="true">DESLOGAR</a>
    </nav>
  </header>

  <main>
    <div class="frame" id="app">
      <div class="title">CARRINHO</div>

      <!-- Formul√°rio para inserir/atualizar produtos -->
      <div style="margin-top:18px;display:flex;align-items:center;justify-content:space-between;gap:10px">
        <div class="form-inline">
          <input id="nome" type="text" placeholder="Nome do produto" />
          <input id="preco" type="text" placeholder="Pre√ßo (ex: 199.90)" />
          <input id="qtd" type="number" placeholder="Qtd" min="1" style="width:80px;"/>
          <button id="salvar" class="btn">Salvar</button>
          <button id="limpar" class="btn" style="background:linear-gradient(#6a6a6a,#3c3c3c)">Limpar</button>
        </div>
        <div class="controls">
          <button id="popular" class="btn" title="">Popular</button>
        </div>
      </div>

      <!-- Lista de itens do carrinho -->
      <div class="cart-list" id="lista"></div>

      <!-- Barra de total -->
      <div class="total-bar">
        <div style="display:flex;align-items:center">
          <span class="cart-icon">üõí</span>
          <strong>Total:</strong>
        </div>
        <div style="display:flex;align-items:center;gap:16px">
          <strong id="total" style="font-size:18px">R$ 0,00</strong>
          <button id="checkout" class="btn">Finalizar</button>
        </div>
      </div>
  </main>

  <footer class="foot">
    ¬© 2025 NuVy Tech ‚Äî Todos os direitos reservados.
  </footer>
  
  <script>
    // ---------- UTILIDADES ----------
    function toBRL(value){
      // formata n√∫mero para R$ 1.234,56 (simples)
      return 'R$ ' + Number(value).toFixed(2).replace('.',',');
    }

    // ---------- CLASSES, HERAN√áA, M√âTODOS E ATRIBUTOS ----------
    // Classe base Produto: atributos e m√©todo subtotal
    class Produto {
      constructor(id, nome, preco, quantidade){
        // atribui√ß√£o: setando atributos do objeto
        this.id = id;                     // id (string)
        this.nome = String(nome);         // for√ßa string
        this.preco = Number(preco);       // for√ßa n√∫mero
        this.quantidade = Number(quantidade);
      }

      // m√©todo: calcula subtotal (aritm√©tico: multiplica√ß√£o)
      subtotal(){
        return this.preco * this.quantidade;
      }
    }

    // Heran√ßa: produto promocional com desconto
    class ProdutoPromocional extends Produto {
      constructor(id, nome, preco, quantidade, descontoPercent){
        super(id, nome, preco, quantidade); // instancia atributos do pai
        this.descontoPercent = Number(descontoPercent) || 0;
      }
      subtotal(){ // sobrescrita de m√©todo (polimorfismo)
        const bruto = super.subtotal();
        const desconto = bruto * (this.descontoPercent / 100); // percentual
        return bruto - desconto;
      }
    }

    // ---------- "Banco de dados" simples com localStorage ----------
    // Usamos a chave 'nuvy_db' para armazenar um array JSON de produtos.
    const DB_KEY = 'nuvy_db';

    function saveDB(arr){
      // converte para string e salva
      localStorage.setItem(DB_KEY, JSON.stringify(arr));
    }
    function loadDB(){
      const raw = localStorage.getItem(DB_KEY);
      if(!raw) return [];
      try {
        const parsed = JSON.parse(raw);
        // Voltamos a instanciar objetos com classes corretas
        return parsed.map(o => {
          // operador tern√°rio: se tiver descontoPercent, cria Promo
          return (o.descontoPercent)
            ? new ProdutoPromocional(o.id, o.nome, o.preco, o.quantidade, o.descontoPercent)
            : new Produto(o.id, o.nome, o.preco, o.quantidade);
        });
      } catch(e){
        console.error('Erro ao carregar DB', e);
        return [];
      }
    }

    // ---------- REGRAS DO CARRINHO (CRUD) ----------
    let produtos = loadDB(); // leitura inicial (leitura / apresenta√ß√£o de registro)

    function inserirProduto(prod){
      // INSER√á√ÉO: adicionar ao array e salvar
      produtos.push(prod);
      saveDB(produtos);
    }

    function atualizarProduto(id, dados){
      // ATUALIZA√á√ÉO: encontrar √≠ndice e aplicar atribui√ß√µes
      const idx = produtos.findIndex(p => p.id === id);
      if(idx >= 0){
        // Object.assign faz merge de atributos (atribui√ß√£o composta)
        Object.assign(produtos[idx], dados);
        saveDB(produtos);
        return true;
      }
      return false;
    }

    function deletarProduto(id){
      // DELE√á√ÉO: filtrar o array (cria novo array sem o id)
      produtos = produtos.filter(p => p.id !== id);
      saveDB(produtos);
    }

    // ---------- RENDER (apresenta√ß√£o) ----------
    const listaEl = document.getElementById('lista');
    const totalEl = document.getElementById('total');

    function renderLista(){
      listaEl.innerHTML = '';
      // forEach: percorre array
      produtos.forEach((p, index) => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <div class="thumb"><img src="${p.img || placeholderFor(p.nome)}" alt="${p.nome}"></div>
          <div class="meta">
            <h3>${p.nome}</h3>
            <p><span class="price-badge">${toBRL(p.preco)}</span> &nbsp; ‚Ä¢ &nbsp; Subtotal: <strong>${toBRL(p.subtotal())}</strong></p>
            <p class="small">${p.descontoPercent ? 'Promo: ' + p.descontoPercent + '% off' : ''}</p>
          </div>
          <div class="right">
            <div class="qtd">Qtd: ${p.quantidade}</div>
            <div class="actions">
              <button class="btn editar" data-id="${p.id}">Editar</button>
              <button class="btn del" data-id="${p.id}">Excluir</button>
            </div>
            <div class="frete">Frete Gr√°tis</div>
          </div>
        `;
        listaEl.appendChild(div);
      });

      // c√°lculo total (uso de la√ßos e aritm√©ticos)
      let total = 0;
      // for cl√°ssico como exemplo:
      for(let i = 0; i < produtos.length; i++){
        total += produtos[i].subtotal(); // incremento via +=
      }
      totalEl.textContent = toBRL(total);

      // associar eventos (forEach para NodeList)
      document.querySelectorAll('.btn.editar').forEach(b => b.addEventListener('click', (e)=>{
        const id = e.currentTarget.dataset.id;
        startEdit(id);
      }));
      document.querySelectorAll('.btn.del').forEach(b => b.addEventListener('click', (e)=>{
        const id = e.currentTarget.dataset.id;
        if(confirm('Remover este produto do carrinho?')){
          deletarProduto(id);
          renderLista();
          renderConsole(); // atualizar exemplos
        }
      }));
    }

    // ---------- FORM L√ìGICA (inserir / atualizar) ----------
    const nomeInput = document.getElementById('nome');
    const precoInput = document.getElementById('preco');
    const qtdInput = document.getElementById('qtd');
    const salvarBtn = document.getElementById('salvar');
    const limparBtn = document.getElementById('limpar');
    const popularBtn = document.getElementById('popular');

    let editingId = null;

    function clearForm(){
      editingId = null;
      nomeInput.value = '';
      precoInput.value = '';
      qtdInput.value = '';
      salvarBtn.textContent = 'Salvar';
    }

    function startEdit(id){
      const p = produtos.find(x => x.id === id);
      if(!p) return;
      editingId = id;
      nomeInput.value = p.nome;
      precoInput.value = p.preco;
      qtdInput.value = p.quantidade;
      salvarBtn.textContent = 'Atualizar';
    }

    salvarBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      const nome = nomeInput.value.trim();
      // aceita v√≠rgula ou ponto
      const preco = parseFloat(String(precoInput.value).replace(',', '.')) || 0;
      const qtd = parseInt(qtdInput.value) || 1;

      // valida√ß√£o b√°sica (if / else e compara√ß√£o)
      if(!nome || preco <= 0 || qtd <= 0){
        alert('Preencha nome, pre√ßo e quantidade v√°lidos.');
        return;
      }

      if(editingId){
        // Exemplo de atribui√ß√£o e atualiza√ß√£o
        atualizarProduto(editingId, { nome, preco, quantidade: qtd });
        clearForm();
        renderLista();
        renderConsole();
        return;
      }

      // cria√ß√£o de ID simples: timestamp + random (string)
      const id = String(Date.now()) + Math.floor(Math.random() * 999);

      // operador tern√°rio: aplica promo√ß√£o autom√°tica se preco > 100
      const temPromocao = (preco > 100) ? 10 : 0;

      // instancia produto ou produto promocional (exemplo de instancia√ß√£o e heran√ßa)
      const produto = (temPromocao > 0)
        ? new ProdutoPromocional(id, nome, preco, qtd, temPromocao)
        : new Produto(id, nome, preco, qtd);

      // adicionar imagem de exemplo (URLs do Unsplash)
      produto.img = sampleImageFor(nome);

      inserirProduto(produto);
      clearForm();
      renderLista();
      renderConsole();
    });

    limparBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      clearForm();
    });

    // popular: adiciona alguns produtos de exemplo
    popularBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      popularExemplos();
      renderLista();
      renderConsole();
    });

    // ---------- Imagens de amostra ----------
    function sampleImageFor(nome){
      const n = nome.toLowerCase();
      if(n.includes('teclado')) return 'https://i.pinimg.com/736x/f8/72/83/f872836d981b8ea8900f1e6f1bfdb937.jpg';
      if(n.includes('microfone') || n.includes('microfone')) return 'https://i.pinimg.com/736x/ed/f1/a0/edf1a046d731a49345b0ca4e5e65da03.jpg';
      if(n.includes('mouse')) return 'https://i.pinimg.com/1200x/dd/dc/bf/dddcbfe68957cec1bb8548cc706e1362.jpg';
      return 'https://images.unsplash.com/photo-1526178616370-9c4a5f4d5f82?q=80&w=800&auto=format&fit=crop';
    }
    function placeholderFor(nome){
      return sampleImageFor(nome);
    }

    // ---------- Exemplos de loops: while / do-while ----------
    function demoLoops(){
      let o = '';
      // while: executa enquanto condi√ß√£o verdadeira (pr√©-teste)
      let c = 0;
      while(c < 2){
        o += `while -> c=${c}\\n`;
        c++; // incremento: ++
      }
      // do-while: executa ao menos uma vez (p√≥s-teste)
      let d = 0;
      do {
        o += `do-while -> d=${d}\\n`;
        d++;
      } while(d < 2);
      return o;
    }

    // ---------- switch (exemplo) ----------
    function demoSwitch(x){
      switch(x){
        case 'promo': return 'Cupom promocional aplicado';
        case 'full': return 'Frete gr√°tis';
        default: return 'Sem condi√ß√£o especial';
      }
    }

    // ---------- FUN√á√ïES COM PAR√ÇMETROS (exemplo) ----------
    function soma(a, b){
      return a + b;
    }

    // ---------- Exemplo final com muitos conceitos (renderConsole) ----------
    const consoleEl = document.getElementById('console');

    function renderConsole(){
      let out = '';

      // Aritm√©ticos
      const somaEx = 5 + 3;
      const subEx = 10 - 4;
      const mulEx = 6 * 7;
      const divEx = 20 / 4;
      const modEx = 7 % 3;
      out += `Aritm√©ticos: 5+3=${somaEx}, 10-4=${subEx}, 6*7=${mulEx}, 20/4=${divEx}, 7%3=${modEx}\\n\\n`;

      // Strings e concatena√ß√£o
      const s1 = 'Nu', s2 = 'Vy';
      out += `Strings: concat('${s1}','${s2}') => ${s1 + s2}\\n\\n`;

      // Atribui√ß√£o e compara√ß√£o
      let a = 5;
      out += `Atribui√ß√£o: a = 5 -> (a === 5)? ${a === 5}\\n\\n`;

      // Incremento/Decremento
      let inc = 0;
      inc++; // p√≥s-incremento
      inc += 2; // atribui√ß√£o composta
      out += `Incremento: inc inicial 0 -> inc++ -> inc+=2 => ${inc}\\n\\n`;

      // Operadores l√≥gicos
      const logico = (true && false) || !false;
      out += `L√≥gicos: (true && false) || !false => ${logico}\\n\\n`;

      // Operador tern√°rio
      const tern = (10 > 5) ? 'maior' : 'menor';
      out += `Tern√°rio: (10>5) ? 'maior' : 'menor' => ${tern}\\n\\n`;

      // Arrays - declara√ß√£o, push, forEach
      const arr = [1,2,3];
      arr.push(4); // inser√ß√£o
      out += `Array: [1,2,3] -> push(4) => [${arr}]\\n`;
      out += 'for cl√°ssico:';
      for(let i=0;i<3;i++){ out += ` ${i}`; }
      out += '\\nforEach:';
      arr.forEach((v,idx) => { out += ` idx=${idx},val=${v};`; });
      out += '\\n\\n';

      // while / do-while
      out += demoLoops() + '\\n';

      // if / else
      const cond = 7;
      if(cond > 10){
        out += 'if: maior que 10\\n';
      } else {
        out += 'if/else: menor ou igual a 10\\n';
      }

      // switch
      out += `switch('a') => ${demoSwitch('a')}\\n\\n`;

      // fun√ß√£o com par√¢metros
      out += `fun√ß√£o soma(4,5) => ${soma(4,5)}\\n\\n`;

      // classes e instancia√ß√£o
      const exProd = new Produto('id', 'Teclado Ex', 199.9, 1);
      out += `Classes: new Produto('id','Teclado',199.9,1) => subtotal ${toBRL(exProd.subtotal())}\\n\\n`;

      // Leitura e apresenta√ß√£o (localStorage)
      out += `Banco (localStorage) => ${produtos.length} registro(s)\\n`;
      // Mostrar os nomes dos produtos (usar forEach)
      produtos.forEach((p, i) => { out += ` ${i+1}) ${p.nome} (${toBRL(p.preco)})\\n`; });

      consoleEl.textContent = out;
    }

    // ---------- helpers para popular dados de exemplo ----------
    function popularExemplos(){
      // Se j√° existir algo, limpa e re-popula (exemplo de atribui√ß√£o e uso de array)
      produtos = []; // atribui√ß√£o
      // Exemplo de inst√¢ncia√ß√£o com desconto (heran√ßa)
      produtos.push(new ProdutoPromocional(String(Date.now()) + '1', 'Teclado Mecanico RGB Est√©tico e Gamer', 199.00, 1, 0));
      produtos[0].img = sampleImageFor('teclado');

      produtos.push(new Produto(String(Date.now()) + '2', 'Microfone Rosa - Streaming', 159.90, 1));
      produtos[1].img = sampleImageFor('microfone');

      produtos.push(new Produto(String(Date.now()) + '3', 'Mouse Razer Mercury White', 159.90, 1));
      produtos[2].img = sampleImageFor('mouse');

      saveDB(produtos);
    }

    // ---------- Inicializa√ß√£o ----------
    // Se DB vazio, popular com exemplos automaticamente (exemplo de compara√ß√£o)
    if(produtos.length === 0){
      popularExemplos();
    }
    renderLista();
    renderConsole();

    // ---------- Observa√ß√µes finais (seguran√ßa & dicas) ----------
    /* 
      - localStorage persiste apenas no navegador do usu√°rio. Para DB real, substitua por backend + BD.
      - Validar entradas e sanitizar em ambiente real para evitar XSS/SQL injection.
      - IDs gerados aqui s√£o simples; em produ√ß√£o use UUIDs ou IDs do servidor.
      - Este prot√≥tipo tem muitos coment√°rios para servir como material did√°tico.
    */

  </script>
</body>
</html>
